function check_tab_in_url(){let e=new URL(window.location.href).searchParams.get("eftab");e&&openTab("",e)}function openTab(e,t){e&&e.preventDefault();let r=document.querySelector('[data-tabid="'+t+'"'),o=new URL(window.location.href);var a,l;for(o.searchParams.set("eftab",t),window.history.replaceState("","",o),l=document.getElementsByClassName("tabcontent"),a=0;a<l.length;a++)l[a].style.display="none";document.querySelectorAll(".tablink").forEach((function(e){e.classList.remove("active")})),document.getElementById(t).style.display="block",r.classList.add("active");let i=document.querySelector('[name="_wp_http_referer"]'),n=i.value;if(i){let e=new URL(twtheme_vars.home_url+n);e.searchParams.set("eftab",t),i.value=e.href.replace(twtheme_vars.home_url,"")}}function codemirror_action(){document.querySelectorAll(".codemirror-htmlmixed").forEach((function(e){if(null==e.nextElementSibling||null!=e.nextElementSibling&&!e.nextElementSibling.classList.contains("CodeMirror"))CodeMirror.fromTextArea(e,{name:"htmlmixed",tags:{style:[["type",/^text\/(x-)?scss$/,"text/x-scss"],[null,null,"css"]],custom:[[null,null,"customMode"]]},autoRefresh:!0,styleActiveLine:!0,lineNumbers:!0,lineWrapping:!0,foldGutter:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"]})})),document.querySelectorAll(".codemirror-javascript").forEach((function(e){CodeMirror.fromTextArea(e,{mode:"javascript",autoRefresh:!0,styleActiveLine:!0,lineNumbers:!0,lineWrapping:!0,foldGutter:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"]})}))}function repeater_fields(){document.querySelectorAll(".repeater-groups-holder").forEach((e=>{repeater_block_btn=e.querySelector(".add-block"),repeater_block_btn.addEventListener("click",(t=>{t.preventDefault(),add_repeater_block(e),repeater_fields_refresh_keys(e)}))})),remove_repeater_block()}function repeater_fields_refresh_keys(e){let t=e.querySelectorAll(".repeater-group");t.length;t.forEach(((e,t)=>{e.dataset.repeatergroupkey=t,e.querySelectorAll("*").forEach((e=>{e.getAttributeNames().forEach((r=>{e.setAttribute(r,e.getAttribute(r).replace(/\[\d\]/gm,"["+t+"]")),"class"==r&&e.classList.contains("wp-editor-area")&&(e.setAttribute("id",e.getAttribute("id").replace(/\d/g,t)),refresh_wp_editor(e.getAttribute("id")))}))}))}))}function add_repeater_block(e){e.querySelectorAll(".wp-editor-area").forEach(((e,t)=>{let r=e.id;wp.editor.remove(r)}));let t=e.querySelector(".repeater-group").outerHTML;e.querySelector(".drag-fields").insertAdjacentHTML("beforeend",t);e.querySelector(".repeater-group:last-child").querySelectorAll("input, select, textarea, .tw_gallery_mtb").forEach((e=>{switch(e.tagName){case"INPUT":e.value="";break;case"TEXTAREA":case"UL":e.innerHTML=""}})),e.querySelectorAll(".wp-editor-area").forEach(((e,t)=>{refresh_wp_editor(e.id)})),tom_select()}function remove_repeater_block(){document.addEventListener("click",(e=>{let t=e.target;if(!t.classList.contains("dashicons-trash"))return;let r=t.closest(".repeater-groups-holder");t.closest(".repeater-group").remove(),repeater_fields_refresh_keys(r)}))}function handle_integrations(){document.addEventListener("change",(e=>{let t=e.target;t.closest("table").querySelectorAll("[data-source]").forEach(((e,r)=>{if(e.dataset.source!=t.id)return!1;if(e.hasAttribute("data-integration")){let r=JSON.parse(e.dataset.integration);if("gmaps"==r.tool&&"geocoding"==r.service){let r=document.querySelector('[id="'+e.dataset.source+'"]').value;geocoder=new google.maps.Geocoder,geocoder.geocode({address:r},(function(r,o){if(elements_parent=t.closest("td"),o==google.maps.GeocoderStatus.OK){validation_message(t,"remove");var a=r[0].geometry.location.lat(),l=r[0].geometry.location.lng();e.value=a+", "+l}else validation_message(t,"add","error","Fehler: "+o)}))}}}))})),document.addEventListener("click",(e=>{let t=e.target;if(t.classList.contains("map-preview")){let e=t.closest("td"),r=e.querySelector("input").value.split(","),o={lat:parseFloat(r[0].trim()),lng:parseFloat(r[1].trim())};document.querySelector("#map-preview")&&document.querySelector("#map-preview").remove(),e.insertAdjacentHTML("beforeend",'<div id="map-preview"></div>');const a=new google.maps.Map(document.getElementById("map-preview"),{center:o,zoom:12});return new google.maps.Marker({position:o,map:a}),a}}))}function validation_message(e,t,r,o){e.nextElementSibling&&e.nextElementSibling.classList.contains("message")&&e.nextElementSibling.remove(),"add"==t&&e.insertAdjacentHTML("afterend",'<span class="message '+r+'">'+o+"</span>")}function repeater_sortable(e){"refresh"==e&&Sortable.destroy(),document.querySelectorAll(".drag-fields").forEach((e=>{let t=e.querySelector(".table-wrapper"),r=e.closest(".repeater-groups-holder");e.querySelectorAll(".drag").forEach(((e,t)=>{e.closest(".table-wrapper");e.addEventListener("mouseenter",(e=>{}))})),Sortable.create(e,{handle:".drag",animation:150,onChoose:function(o){e.classList.add("dragging"),r.style.setProperty("--height",t.getBoundingClientRect().height+"px"),e.insertAdjacentHTML("afterend",'<div class="repeater-group-spacer"></div>'),o.item.querySelector(".table-wrapper").classList.add("active")},onStart:function(t){e.closest(".repeater-groups-holder").querySelectorAll(".wp-editor-area").forEach(((e,t)=>{let r=e.id;wp.editor.remove(r)}))},onUnchoose:function(t){repeater_fields_refresh_keys(e.closest(".repeater-groups-holder")),r.style.removeProperty("--height"),r.querySelector(".repeater-group-spacer").remove(),e.classList.remove("dragging"),t.item.querySelector(".table-wrapper").classList.remove("active"),tom_select()}})}))}function gallery_sortable(){document.querySelectorAll(".tw_gallery_mtb").forEach((e=>{Sortable.create(e,{handle:"li",animation:150,onEnd:function(e){let t=e.item.closest("ul"),r=e.item.closest("td"),o="";t.querySelectorAll("li").forEach(((e,t)=>{o+=0===t?e.dataset.id:","+e.dataset.id})),r.querySelector("input.image_data_field").value=o}})}))}function refresh_wp_editor(e){wp.editor.remove(e);wp.editor.initialize(e,{tinymce:{wpautop:!0,toolbar1:"formatselect, bold, italic, bullist, numlist, blockquote, hr, alignleft, aligncenter, alignright, link, unlink, wp_more, spellchecker, fullscreen, wp_adv",toolbar2:"strikethrough, underline, alignjustify, forecolor, pastetext, removeformat, charmap, outdent, indent, undo, redo, wp_help"},quicktags:{buttons:"strong,em,link,block,ins,img,ul,ol,li,code,more,close"}})}function make_field_editable(){document.querySelectorAll(".button.make-editable").forEach(((e,t)=>{e.addEventListener("click",(e=>{e.preventDefault(),e.target.previousElementSibling.removeAttribute("readonly"),e.target.previousElementSibling.removeAttribute("disabled")}))}))}function tom_select(){var e={};document.querySelectorAll(".tw-page-wrapper select").forEach(((t,r)=>{let o=t.nextElementSibling;o&&o.classList.contains("ts-wrapper")&&t.tomselect.destroy();new TomSelect(t,e)}))}jQuery(document).ready((function($){function e(e,t){for(var r in t)if(t[r]==e)return!0;return!1}$(".colorpicker").hide(),$(".colorpicker").each((function(){$(this).farbtastic($(this).closest(".color-picker").find(".color"))})),$(".color").click((function(){$(this).closest(".color-picker").find(".colorpicker").fadeIn()})),$(document).mousedown((function(){$(".colorpicker").each((function(){"block"==$(this).css("display")&&$(this).fadeOut()}))})),jQuery(document).on("click",".image_upload_button",(function(t){t.preventDefault();var r,o=jQuery(this),a=o.next(),l=o.prev("ul"),i=a.val().split(","),n=o.closest("td");if(r)return void r.open();let s=!!o.attr("multiple");(r=wp.media({title:jQuery(this).data("uploader_title"),library:{type:"image"},button:{text:jQuery(this).data("uploader_button_text")},multiple:s})).on("open",(function(){let e=r.state().get("selection");i.forEach((function(t){let r=wp.media.attachment(t);e.add(r?[r]:[])}))})),r.on("select",(function(){var t,o=r.state().get("selection").map((function(e){return e.toJSON(),e})),c=!1;for(t=0;t<o.length;++t)e(o[t].id,i)?c=!0:s?(l.append('<li data-id="'+o[t].id+'"><span style="background-image:url('+o[t].attributes.url+')"></span><a href="#" class="tw_gallery_remove">&times;</a></li>'),i.push(o[t].id)):(l.html('<li data-id="'+o[t].id+'"><span style="background-image:url('+o[t].attributes.url+')"></span><a href="#" class="tw_gallery_remove">&times;</a></li>'),i[0]=o[t].id);n.find("input").val(i.join()),a.val(i.join()),1==c&&alert("Die gleichen Bilder sind nicht erlaubt!")})),r.open()})),jQuery(".image_delete_button").click((function(){return jQuery(this).closest("td").find(".image_data_field").val(""),jQuery(this).closest("td").find(".image_preview").attr("src",""),!1})),$("body").on("click",".tw_gallery_remove",(function(){var e=$(this).parent().attr("data-id"),t=$(this).parent().parent().parent().find('input[type="hidden"]'),r=t.val().split(","),o=r.indexOf(e);return $(this).parent().remove(),-1!=o&&r.splice(o,1),t.val(r.join()),!1}))})),check_tab_in_url(),codemirror_action(),repeater_fields(),handle_integrations(),repeater_sortable(),gallery_sortable(),make_field_editable(),tom_select();